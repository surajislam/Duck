<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Telegram Search Pro — Login / Signup</title>
  <style>
    /* minimal in-file styles (you can move to static later) */
    body{font-family:Inter,system-ui,Arial;background:#0d1421;color:#e6eef6;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
    .card{width:100%;max-width:460px;background:rgba(13,20,33,.95);border:1px solid rgba(64,224,208,.12);border-radius:16px;padding:32px;box-shadow:0 10px 40px rgba(0,0,0,.6)}
    h1{margin:0 0 8px;font-size:26px;color:linear-gradient(#40e0d0,#7b68ee)}
    p.sub{color:#9fb0bd;margin:0 0 18px}
    .tabs{display:flex;margin-bottom:18px;background:rgba(15,15,35,.6);padding:4px;border-radius:10px}
    .tab{flex:1;padding:8px 10px;border-radius:8px;background:transparent;color:#9fb0bd;border:none;cursor:pointer;font-weight:600}
    .tab.active{background:linear-gradient(135deg,#40e0d0,#48cc8c);color:#071217}
    label{display:block;color:#40e0d0;font-weight:700;margin-bottom:8px;font-size:14px}
    input[type="text"], input[type="number"]{width:100%;padding:14px;border-radius:12px;border:2px solid rgba(64,224,208,.12);background:rgba(7,10,14,.7);color:#e6eef6;margin-bottom:12px;font-weight:600}
    button.primary{width:100%;padding:14px;border-radius:12px;border:none;font-weight:800;cursor:pointer;background:linear-gradient(135deg,#40e0d0,#48cc8c);color:#071217}
    button.ghost{width:100%;padding:10px;border-radius:12px;border:1px solid rgba(64,224,208,.12);background:transparent;color:#9fb0bd;cursor:pointer}
    .msg{margin-top:12px;padding:12px;border-radius:10px;display:none}
    .msg.error{background:rgba(248,113,113,.08);color:#ffc7c7;border:1px solid rgba(248,113,113,.12)}
    .msg.success{background:rgba(72,204,140,.06);color:#bff0d2;border:1px solid rgba(72,204,140,.12)}
    .hash-box{background:rgba(64,224,208,.06);border:1px solid rgba(64,224,208,.12);padding:12px;border-radius:10px;margin-top:12px;color:#40e0d0;font-family:monospace;font-weight:700;word-break:break-all}
    .small{font-size:13px;color:#9fb0bd;margin-top:8px}
  </style>
</head>
<body>
  <div class="card" role="main">
    <h1>Telegram Search Pro</h1>
    <p class="sub">Login with your 12-digit hash code or create an account</p>

    <div class="tabs" role="tablist" aria-label="Auth tabs">
      <button class="tab active" id="tab-login" onclick="switchTab('login')">Login</button>
      <button class="tab" id="tab-signup" onclick="switchTab('signup')">Sign up</button>
    </div>

    <!-- LOGIN -->
    <div id="panel-login">
      <label for="loginHash">Hash code</label>
      <input id="loginHash" type="text" maxlength="12" placeholder="Enter 12-char hash code (no @)" autocomplete="off">

      <button class="primary" id="loginBtn" onclick="doLogin()">Login</button>

      <div class="small">Don't have a code? Create an account using Sign up tab and copy the code shown.</div>
    </div>

    <!-- SIGNUP -->
    <div id="panel-signup" style="display:none">
      <label for="signupName">Your name</label>
      <input id="signupName" type="text" placeholder="Full name">

      <button class="primary" id="signupBtn" onclick="doSignup()">Create account</button>

      <div id="signupResult" class="hash-box" style="display:none"></div>
      <div class="small">Save your hash code — you will need it to login.</div>
    </div>

    <hr style="border:none;border-top:1px solid rgba(64,224,208,.06);margin:18px 0">

    <!-- COUPON (works without login too; server saves in session) -->
    <label for="coupon">Coupon / UTR (for unlimited or deposit)</label>
    <input id="coupon" type="text" placeholder="Enter coupon (e.g. SBSIMPLE00) or UTR">

    <label for="couponAmount" style="margin-top:6px">If depositing by UTR, select amount</label>
    <input id="couponAmount" type="number" placeholder="Amount (60,90,120,900,1800)">

    <button class="ghost" onclick="applyCoupon()">Apply coupon / deposit</button>

    <div id="msg" class="msg"></div>

    <div style="margin-top:14px;text-align:center" class="small">
      Need help? Contact <a href="https://t.me/hackingteamx" target="_blank" style="color:#40e0d0;text-decoration:none">t.me/hackingteamx</a>
    </div>
  </div>

<script>
  function switchTab(tab){
    document.getElementById('tab-login').classList.remove('active');
    document.getElementById('tab-signup').classList.remove('active');
    document.getElementById('panel-login').style.display = 'none';
    document.getElementById('panel-signup').style.display = 'none';

    if(tab === 'login'){
      document.getElementById('tab-login').classList.add('active');
      document.getElementById('panel-login').style.display = 'block';
    } else {
      document.getElementById('tab-signup').classList.add('active');
      document.getElementById('panel-signup').style.display = 'block';
    }
    hideMsg();
  }

  function showMsg(text,type='error'){
    const el = document.getElementById('msg');
    el.className = 'msg ' + (type==='success' ? 'success' : 'error');
    el.style.display = 'block';
    el.textContent = text;
  }
  function hideMsg(){ const el=document.getElementById('msg'); el.style.display='none' }

  async function doSignup(){
    hideMsg();
    const name = document.getElementById('signupName').value.trim();
    if(!name || name.length < 2){ showMsg('Enter full name (min 2 chars)'); return; }
    const btn = document.getElementById('signupBtn'); btn.disabled=true; btn.textContent='Creating...';
    try{
      const res = await fetch('/signup', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({name})});
      const j = await res.json();
      if(j.success){
        const box = document.getElementById('signupResult');
        box.style.display='block';
        box.textContent = 'Your hash code: ' + j.hash_code + '\n\nName: ' + j.name;
        showMsg('Account created. Save your hash code!', 'success');
        // auto-switch to login tab so user can paste code
        switchTab('login');
      } else {
        showMsg(j.error || 'Signup failed');
      }
    }catch(e){
      console.error(e); showMsg('Network error');
    } finally { btn.disabled=false; btn.textContent='Create account' }
  }

  async function doLogin(){
    hideMsg();
    const code = document.getElementById('loginHash').value.trim();
    if(!code || code.length < 4){ showMsg('Enter your hash code'); return; }
    const btn = document.getElementById('loginBtn'); btn.disabled=true; btn.textContent='Logging in...';
    try{
      const res = await fetch('/login', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({hash_code: code})});
      const j = await res.json();
      if(j.success){
        showMsg(j.message || 'Welcome', 'success');
        // redirect to dashboard
        setTimeout(()=> window.location.href = '/dashboard', 700);
      } else {
        showMsg(j.error || 'Login failed');
      }
    }catch(e){ console.error(e); showMsg('Network error') }
    finally { btn.disabled=false; btn.textContent='Login' }
  }

  async function applyCoupon(){
    hideMsg();
    const coupon = document.getElementById('coupon').value.trim();
    const amount = parseInt(document.getElementById('couponAmount').value) || 0;
    if(!coupon){ showMsg('Enter coupon or UTR'); return; }
    const body = { coupon: coupon, utr: coupon, amount: amount };
    try{
      const res = await fetch('/apply-coupon', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({coupon: coupon})});
      const j = await res.json();
      // apply-coupon endpoint only returns unlimited success or invalid
      if(j.success){
        showMsg(j.message || 'Coupon applied', 'success');
        // If user is already logged in, reload to reflect unlimited state on dashboard
        setTimeout(()=> { location.reload(); }, 800);
      } else {
        // fallback to deposit route (UTR deposit does different checks)
        // call deposit if user provided amount
        if(amount > 0){
          try{
            const r2 = await fetch('/deposit', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({utr: coupon, amount: amount})});
            const j2 = await r2.json();
            if(j2.success){
              showMsg(j2.message || 'Balance added', 'success');
              setTimeout(()=> location.reload(), 900);
            } else {
              showMsg(j2.error || 'Invalid UTR or coupon');
            }
          }catch(e){ console.error(e); showMsg('Network error during deposit') }
        } else {
          showMsg(j.error || 'Invalid coupon');
        }
      }
    }catch(e){
      console.error(e);
      showMsg('Network error while applying coupon');
    }
  }
</script>
</body>
</html>
